\documentclass[12pt,a4paper]{book}
\usepackage[spanish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=red]{hyperref}
\usepackage{graphicx}
\graphicspath{{figuras/}}

\IfFileExists{build.tex}{\input{build.tex}}{\def\BuildSHA{local}\def\BuildDate{local}}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyfoot[C]{Build: \BuildSHA\ (\BuildDate)}
\renewcommand{\headrulewidth}{0pt}

% Fija el idioma activo desde el inicio (evita 'nil' en el TOC)
\AtBeginDocument{\selectlanguage{spanish}}

% Evita el warning de fancyhdr sobre la altura del encabezado
\setlength{\headheight}{15.5pt}

% --- Flag para builds por capítulo (debe ir ANTES de \chaptersel) ---
\newif\ifonlychapter
\onlychapterfalse % build normal por defecto

% --- Hook opcional (no-op por defecto; los *_only.tex lo redefinen) ---
\providecommand{\chaptersel}{}
\chaptersel

\ifonlychapter
  \makeatletter
    \@openrightfalse            % anula 'openright' solo en builds por capítulo
      \let\cleardoublepage\clearpage % cinturón y tirantes: evita páginas en blanco
        \makeatother
        \fi

        \begin{document}

        % Si es build normal: frontmatter + TOC + mainmatter.
        % Si es solo capítulo: entra directo a mainmatter y NO hay TOC.
        \ifonlychapter
          \mainmatter
          \else
            \frontmatter
              \tableofcontents
                \mainmatter
                \fi

                \include{capitulos/cap1}
                \include{capitulos/cap2}
                \include{capitulos/cap3}

                \backmatter
                % Bibliografía más adelante

                \end{document}
