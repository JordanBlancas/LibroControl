\documentclass[12pt,a4paper]{book}
\usepackage[spanish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=red]{hyperref}
\usepackage{graphicx}
\graphicspath{{figuras/}}

\IfFileExists{build.tex}{\input{build.tex}}{\def\BuildSHA{local}\def\BuildDate{local}}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyfoot[C]{Build: \BuildSHA\ (\BuildDate)}
\renewcommand{\headrulewidth}{0pt}


% --- Flag para builds por capítulo (debe ir ANTES de \chaptersel) ---
\newif\ifonlychapter
\onlychapterfalse % build normal por defecto


% Si es build solo de capítulo, desactiva la apertura en impar
\ifonlychapter
  \let\cleardoublepage\clearpage
\fi



% --- Hook opcional (no-op por defecto; los *_only.tex lo redefinen) ---
\providecommand{\chaptersel}{}
\chaptersel


\begin{document}

% Si es build normal: frontmatter + TOC + mainmatter.
% Si es solo capítulo: entra directo a mainmatter y NO hay TOC.
\ifonlychapter
  \mainmatter
\else
  \frontmatter
  \tableofcontents
  \mainmatter
\fi

\include{capitulos/cap1}
\include{capitulos/cap2}
\include{capitulos/cap3}

\backmatter
% Bibliografía más adelante

\end{document}
